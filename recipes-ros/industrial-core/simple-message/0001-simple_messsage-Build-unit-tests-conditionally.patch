From 60378bc5f3daf407e774b978506ee2557a6cc471 Mon Sep 17 00:00:00 2001
From: Lukas Bulwahn <lukas.bulwahn@gmail.com>
Date: Tue, 3 Oct 2017 11:28:46 +0200
Subject: [PATCH] simple_messsage: Build unit tests conditionally

---
 simple_message/CMakeLists.txt | 30 ++++++++++++++++++------------
 1 file changed, 18 insertions(+), 12 deletions(-)

diff --git a/simple_message/CMakeLists.txt b/simple_message/CMakeLists.txt
index 3ef1f0e..2fa60bc 100644
--- a/simple_message/CMakeLists.txt
+++ b/simple_message/CMakeLists.txt
@@ -101,9 +101,6 @@ add_library(simple_message ${SRC_FILES})
 target_link_libraries(simple_message ${catkin_LIBRARIES})
 add_dependencies(simple_message ${industrial_msgs_EXPORTED_TARGETS})
 
-catkin_add_gtest(utest ${UTEST_SRC_FILES})
-set_target_properties(utest PROPERTIES COMPILE_DEFINITIONS "TEST_PORT_BASE=51000")
-target_link_libraries(utest simple_message)
 
 # ALTERNATIVE LIBRARY (DIFFERENT ENDIAN)
 add_library(simple_message_bswap ${SRC_FILES})
@@ -111,9 +108,6 @@ set_target_properties(simple_message_bswap PROPERTIES COMPILE_DEFINITIONS "BYTE_
 target_link_libraries(simple_message_bswap ${catkin_LIBRARIES})
 add_dependencies(simple_message_bswap ${industrial_msgs_EXPORTED_TARGETS})
 
-catkin_add_gtest(utest_byte_swapping ${UTEST_SRC_FILES})
-set_target_properties(utest_byte_swapping PROPERTIES COMPILE_DEFINITIONS "TEST_PORT_BASE=52000")
-target_link_libraries(utest_byte_swapping simple_message_bswap)
 
 # ALTERNATIVE LIBRARY (64-bit floats)
 add_library(simple_message_float64 ${SRC_FILES})
@@ -121,13 +115,25 @@ set_target_properties(simple_message_float64 PROPERTIES COMPILE_DEFINITIONS "FLO
 target_link_libraries(simple_message_float64 ${catkin_LIBRARIES})
 add_dependencies(simple_message_float64 ${industrial_msgs_EXPORTED_TARGETS})
 
-catkin_add_gtest(utest_float64 ${UTEST_SRC_FILES})
-set_target_properties(utest_float64 PROPERTIES COMPILE_DEFINITIONS "TEST_PORT_BASE=53000;FLOAT64")
-target_link_libraries(utest_float64 simple_message_float64)
+if (CATKIN_ENABLE_TESTING)
 
-catkin_add_gtest(utest_udp ${UTEST_SRC_FILES})
-set_target_properties(utest_udp PROPERTIES COMPILE_DEFINITIONS "TEST_PORT_BASE=55000;UDP_TEST")
-target_link_libraries(utest_udp simple_message)
+    catkin_add_gtest(utest ${UTEST_SRC_FILES})
+    set_target_properties(utest PROPERTIES COMPILE_DEFINITIONS "TEST_PORT_BASE=51000")
+    target_link_libraries(utest simple_message)
+
+    catkin_add_gtest(utest_byte_swapping ${UTEST_SRC_FILES})
+    set_target_properties(utest_byte_swapping PROPERTIES COMPILE_DEFINITIONS "TEST_PORT_BASE=52000")
+    target_link_libraries(utest_byte_swapping simple_message_bswap)
+
+    catkin_add_gtest(utest_float64 ${UTEST_SRC_FILES})
+    set_target_properties(utest_float64 PROPERTIES COMPILE_DEFINITIONS "TEST_PORT_BASE=53000;FLOAT64")
+    target_link_libraries(utest_float64 simple_message_float64)
+
+    catkin_add_gtest(utest_udp ${UTEST_SRC_FILES})
+    set_target_properties(utest_udp PROPERTIES COMPILE_DEFINITIONS "TEST_PORT_BASE=55000;UDP_TEST")
+    target_link_libraries(utest_udp simple_message)
+
+endif()
 
 install(
     TARGETS simple_message simple_message_bswap simple_message_float64 
-- 
1.9.1

