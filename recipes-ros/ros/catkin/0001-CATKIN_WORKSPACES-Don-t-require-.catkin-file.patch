From f8ced9b2abb7c3274ebe6c708443e25fdf0b94f4 Mon Sep 17 00:00:00 2001
From: Johannes Schrimpf <johannes.schrimpf@blueye.no>
Date: Thu, 14 Nov 2019 16:27:02 +0100
Subject: [PATCH] CATKIN_WORKSPACES-Don-t-require-.catkin-file

---
 cmake/all.cmake                            | 10 ++++------
 cmake/list_insert_in_workspace_order.cmake |  9 ++++-----
 2 files changed, 8 insertions(+), 11 deletions(-)

diff --git a/cmake/all.cmake b/cmake/all.cmake
index 7768f96..5efef2a 100644
--- a/cmake/all.cmake
+++ b/cmake/all.cmake
@@ -57,12 +57,10 @@ set(CMAKE_PREFIX_PATH_AS_IS ${CMAKE_PREFIX_PATH})
 # list of unique catkin workspaces based on CMAKE_PREFIX_PATH
 set(CATKIN_WORKSPACES "")
 foreach(path ${CMAKE_PREFIX_PATH})
-  if(EXISTS "${path}/.catkin")
-    file(TO_CMAKE_PATH "${path}" cmake_path)
-    list(FIND CATKIN_WORKSPACES ${cmake_path} _index)
-    if(_index EQUAL -1)
-      list(APPEND CATKIN_WORKSPACES ${cmake_path})
-    endif()
+  file(TO_CMAKE_PATH "${path}" cmake_path)
+  list(FIND CATKIN_WORKSPACES ${cmake_path} _index)
+  if(_index EQUAL -1)
+    list(APPEND CATKIN_WORKSPACES ${cmake_path})
   endif()
 endforeach()
 if(CATKIN_WORKSPACES)
diff --git a/cmake/list_insert_in_workspace_order.cmake b/cmake/list_insert_in_workspace_order.cmake
index 7f8c574..9b6dbb3 100644
--- a/cmake/list_insert_in_workspace_order.cmake
+++ b/cmake/list_insert_in_workspace_order.cmake
@@ -4,12 +4,11 @@
 set(CATKIN_ORDERED_SPACES "")
 foreach(_space ${CATKIN_DEVEL_PREFIX} ${CATKIN_WORKSPACES})
   list(APPEND CATKIN_ORDERED_SPACES ${_space})
-  if(NOT EXISTS "${_space}/.catkin")
-    message(FATAL_ERROR "The path '${_space}' is in CATKIN_WORKSPACES but does not have a .catkin file")
+  if(EXISTS "${_space}/.catkin")
+    # prepend to existing list of sourcespaces
+    file(READ "${_space}/.catkin" _sourcespaces)
+    list(APPEND CATKIN_ORDERED_SPACES ${_sourcespaces})
   endif()
-  # prepend to existing list of sourcespaces
-  file(READ "${_space}/.catkin" _sourcespaces)
-  list(APPEND CATKIN_ORDERED_SPACES ${_sourcespaces})
 endforeach()
 
 debug_message(10 "CATKIN_ORDERED_SPACES ${CATKIN_ORDERED_SPACES}")
-- 
2.21.0 (Apple Git-122)

